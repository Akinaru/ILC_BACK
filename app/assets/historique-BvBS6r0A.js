import{k as B,r as p,c as T,o as V,d as a,e as n,g as e,A as b,B as i,F as x,t as k,u as h,q as S,v as $,C as z,h as v,i as m,x as E,I as D,y as U}from"./index-B86mjc3y.js";import{t as F,g as y}from"./actionType-CQghQJMu.js";const L={class:"overflow-x-auto min-h-screen"},H=e("div",{class:"flex w-full justify-between"},[e("p",{class:"font-bold text-xl"},"Historique"),e("label",{for:"delete",class:"btn btn-error"},"Supprimer l'historique")],-1),N={class:"py-4"},Z={class:"flex justify-between items-center"},G={class:"flexitems-start flex-col w-fit"},I={class:"flex py-3"},O=["for"],P=["id","value"],Q=["for"],R={class:"input input-bordered flex items-center gap-2 w-full"},Y=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4 opacity-70"},[e("path",{"fill-rule":"evenodd",d:"M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z","clip-rule":"evenodd"})],-1),J=e("input",{type:"checkbox",id:"delete",class:"modal-toggle"},null,-1),K={class:"modal",role:"dialog"},W={class:"modal-box"},X=e("h3",{class:"font-bold text-lg"},"Confirmation requise",-1),ee=e("p",{class:"py-4"},"Confirmez vous la suppression de l'historique ?",-1),te={class:"modal-action"},se=e("label",{for:"delete",class:"btn"},"Annuler",-1),le={key:0,class:"table table-zebra"},oe={class:"select-none"},ae=e("th",null,"n°",-1),ne=e("th",null,"Login",-1),ie=e("th",null,"Description",-1),re={class:"flex items-center justify-between cursor-pointer"},ce={class:"ml-2"},ue={key:0,"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 01.75.75v15.69l5.47-5.47a.75.75 0 111.06 1.06l-6.75 6.75a.75.75 0 01-1.06 0l-6.75-6.75a.75.75 0 011.06-1.06l5.47 5.47V4.5a.75.75 0 01.75-.75z","clip-rule":"evenodd"},de={key:1,"fill-rule":"evenodd",d:"M12 20.25a.75.75 0 01-.75-.75V3.81l-5.47 5.47a.75.75 0 01-1.06-1.06l6.75-6.75a.75.75 0 011.06 0l6.75 6.75a.75.75 0 01-1.06 1.06L12.75 3.81v15.69a.75.75 0 01-.75.75z","clip-rule":"evenodd"},_e=e("th",{class:"flex items-center justify-center"},"Type",-1),pe={class:"w-full"},he={class:"min-w-56 flex items-center justify-center"},fe={class:"flex items-center justify-center min-w-36"},ve={key:1,class:"flex items-center justify-center p-44"},me=e("p",null,"Aucune action n'a été trouvée.",-1),ye=[me],xe={__name:"historique",setup(ge){const C=B(),g=p([]),r=p([]),c=p(""),f=p([]),d=p(!1);async function w(){await v("GET",!1,g,m.apiUrl+"api/action")}const _=T(()=>{let l=g.value;return r.value.length>0&&(l=l.filter(s=>r.value.some(t=>s.act_type===t))),c.value.trim()!==""&&(l=l.filter(s=>s.acc_id.includes(c.value.trim()))),l=l.sort((s,t)=>{const o=new Date(s.act_date),u=new Date(t.act_date);return d.value?o-u:u-o}),l});async function q(){if(await v("DELETE",!0,f,m.apiUrl+"api/action"),f.value.status==202){const l={act_description:"Suppression de l'historique.",acc_id:C.login,admin:1};await v("POST",!1,f,m.apiUrl+"api/action",l)}w()}function M(l){const s=new Date(l),t=String(s.getDate()).padStart(2,"0"),o=String(s.getMonth()+1).padStart(2,"0"),u=s.getFullYear(),j=String(s.getHours()).padStart(2,"0"),A=String(s.getMinutes()).padStart(2,"0");return`${t}/${o}/${u} à ${j}h${A}`}return V(w),(l,s)=>(a(),n("div",L,[H,e("div",N,[e("p",null,[b("Filtres: "),e("span",null,i(_.value.length)+" résultat"+i(_.value.length>1?"s":"")+" avec "+i(r.value.length+(c.value!==""?1:0))+" filtre"+i(r.value.length+(c.value!==""?1:0)>1?"s":""),1)]),e("div",Z,[e("div",G,[e("div",I,[(a(!0),n(x,null,k(h(F),(t,o)=>(a(),n("label",{for:"filt_type_"+o,class:"flex items-center justify-center mr-2 hover:cursor-pointer",key:o},[S(e("input",{type:"checkbox",id:"filt_type_"+o,class:"checkbox mx-1",value:t.condition,"onUpdate:modelValue":s[0]||(s[0]=u=>r.value=u)},null,8,P),[[E,r.value]]),e("label",{for:"filt_type_"+o,class:D(["badge select-none min-w-32 cursor-pointer",t.color])},i(t.name),11,Q)],8,O))),128))]),e("label",R,[S(e("input",{type:"text",class:"grow",placeholder:"Recherche par login","onUpdate:modelValue":s[1]||(s[1]=t=>c.value=t)},null,512),[[$,c.value]]),Y])]),J,e("div",K,[e("div",W,[X,ee,e("div",te,[e("label",{for:"delete",onClick:s[2]||(s[2]=t=>q()),class:"btn btn-success"},"Valider"),se])])])])]),_.value&&_.value.length>0?(a(),n("table",le,[e("thead",null,[e("tr",oe,[ae,ne,ie,e("th",{onClick:s[3]||(s[3]=t=>d.value=!d.value),class:"cursor-pointer hover:opacity-70"},[e("div",re,[b(" Date "),e("span",ce,[(a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4",style:z({transform:d.value.value?"rotate(0deg)":"rotate(180deg)"})},[d.value?(a(),n("path",ue)):(a(),n("path",de))],4))])])]),_e])]),e("tbody",null,[(a(!0),n(x,null,k(_.value,(t,o)=>(a(),n("tr",{key:o},[e("th",null,i(t.act_id),1),e("td",null,i(t.acc_id),1),e("td",pe,i(t.act_description),1),e("td",he,i(M(t.act_date)),1),e("td",null,[e("span",fe,[h(y)(t.act_type)?(a(),n("span",{key:0,class:D(["min-w-32",["badge",h(y)(t.act_type).color]])},i(h(y)(t.act_type).name),3)):U("",!0)])])]))),128))])])):(a(),n("div",ve,ye))]))}};export{xe as default};
