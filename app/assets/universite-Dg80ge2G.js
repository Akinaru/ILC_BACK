import{k as te,r as d,c as O,o as ne,d as i,e as a,g as e,z as $,q as p,v as w,s as F,F as C,t as U,y as B,B as l,I as A,M as se,A as D,E as oe,h as m,i as f,n as le,x as ie,j as q,L as ae}from"./index-WfzvT7mn.js";const re={key:0},ce={class:"m-5 my-20"},ue={class:"m-5 flex justify-center items-center flex-col"},de=e("p",{class:"text-lg font-bold"},"Ajout université",-1),pe={class:"form-control w-full items-center justify-center"},ve=e("option",{disabled:"",selected:"",value:"selectACountry"},"Selectionnez un pays",-1),_e=e("option",{value:"addNew"}," + Créer un pays",-1),me=["value"],fe={key:0,class:"flex items-center justify-center w-full",type:"text"},ye=e("div",{class:"flex items-center justify-center"},[e("button",{class:"btn btn-primary hover:scale-105 transition-all hover:opacity-70",type:"submit"},"Ajouter l'accord")],-1),he=e("p",{class:"font-bold text-xl mb-5"},"Liste des Universités:",-1),be={class:"bg-base-200 w-full drop-shadow-lg block my-10"},we=e("p",{class:"bg-base-300 p-3 flex items-center justify-center font-bold text-lg"},"Filtres",-1),xe={class:"p-1"},ge={class:"flex flex-wrap"},ke=["id","value"],Ce=["for"],Ue=["for"],Ae={class:"flex flex-wrap justify-center gap-2"},je={class:"relative flex items—center justify-between"},Me={class:"flex items-center"},Ve={key:0,class:"absolute inset-0 flex items-center justify-center text-black text-2xl font-bold bg-white select-none"},Ne={class:"ml-2"},Se={class:"flex"},Te=["onClick"],Ee=e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20,16v4a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V6A2,2,0,0,1,4,4H8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"}),e("polygon",{fill:"none",points:"12.5 15.8 22 6.2 17.8 2 8.3 11.5 8 16 12.5 15.8",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),Be=[Ee],De=["onClick"],qe=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Pe=[qe],ze={class:"mt-1"},Le=e("input",{type:"checkbox",id:"modal_modif",class:"modal-toggle"},null,-1),Ie={class:"modal modal-bottom sm:modal-middle",role:"dialog"},Oe={class:"modal-box"},$e={class:"font-bold text-lg"},Fe={class:"form-control w-full"},Ge=e("div",{class:"label"},[e("span",{class:"label-text"},"Nom")],-1),He={class:"form-control w-full"},Je=e("div",{class:"label"},[e("span",{class:"label-text"},"Ville")],-1),Ke={class:"form-control w-full"},Qe=e("div",{class:"label"},[e("span",{class:"label-text"},"Pays")],-1),Re=e("option",{disabled:"",selected:"",value:"selectACountry"},"Selectionnez un pays",-1),We=["value"],Xe=e("div",{class:"modal-action"},[e("label",{for:"modal_modif",class:"btn"},"Annuler"),e("button",{type:"submit"},[e("label",{for:"modal_modif",class:"btn btn-success"},"Enregistrer")])],-1),Ye={id:"confirmModal",ref:"confirmModal",class:"modal"},Ze={class:"modal-box"},et=e("h3",{class:"text-lg font-bold"},"Confirmer la suppression ?",-1),tt={class:"py-3"},nt=e("p",null,"Confirmez vous la supression de l'université:",-1),st=e("p",null,"Cette action entraînera la suppression de l'université dans tous les accords qui y sont liés.",-1),ot={class:"bg-base-300 p-3 my-2 relative"},lt={class:"relative flex items—center justify-between"},it={class:"flex items-center"},at={key:0,class:"absolute inset-0 flex items-center justify-center text-black text-2xl font-bold bg-white select-none"},rt={class:"ml-2"},ct={class:"mt-1"},ut={class:"py-3"},dt={class:"text-lg font-bold"},pt={class:"flex flex-col w-full max-h-64 overflow-y-auto"},vt={class:"mr-2 flex items-center justify-start"},_t={class:"flex flex-col"},mt={class:"w-full select-none"},ft={class:"font-bold"},yt={key:1},ht=e("p",{class:"text-center my-5"},"Aucun accords",-1),bt=[ht],wt={class:"modal-action"},kt={__name:"universite",setup(xt){const N=te(),S=d(!1),P=d([]),T=d([]),x=d([]),c=d([]),v=d([]),_=d([]),r=d([]),o=d({univ_name:"",univ_city:"",parco_id:"",newparco:{parco_name:"",parco_code:""}}),z=O(()=>P.value.filter(n=>v.value.length===0||v.value.includes(n.partnercountry.parco_name)).sort((n,s)=>{const y=n.partnercountry.parco_name||"",b=s.partnercountry.parco_name||"";return y.localeCompare(b)})),j=d({pays:!1});function G(n){j.value[n]=!j.value[n]}function H(n){r.value.univ_id=n.univ_id,r.value.univ_name=n.univ_name,r.value.univ_city=n.univ_city,r.value.parco_id=n.partnercountry.parco_id}async function J(){const n={univ_id:r.value.univ_id,univ_name:r.value.univ_name,univ_city:r.value.univ_city,parco_id:r.value.parco_id};if(await m("PUT",!0,_,f.apiUrl+"api/university",n),_.value.status==200){const s={act_description:"Modification de l'université "+n.univ_name+" ("+n.univ_city+").",acc_id:N.login,univ_id:n.univ_id};await m("POST",!1,_,f.apiUrl+"api/action",s)}M()}function K(n){return T.value.agreements.filter(s=>s.university&&s.university.univ_id===n).length}async function Q(){if(o.value.univ_name==""){q("error",{data:{error:"Vous devez choisir un nom d'université.",message:"Ajout de l'université annulé."}});return}if(o.value.univ_city==""){q("error",{data:{error:"Vous devez choisir un nom de ville.",message:"Ajout de l'université annulé."}});return}const n={univ_name:o.value.univ_name,univ_city:o.value.univ_city};if(o.value.parco_id=="selectACountry"){q("error",{data:{error:"Vous devez choisir un pays.",message:"Ajout de l'université annulé."}});return}if(o.value.parco_id=="addNew"?(n.parco_name=o.value.newparco.parco_name,n.parco_code=o.value.newparco.parco_code,n.parco_id="addNew"):n.parco_id=`${o.value.parco_id}`,await m("POST",!0,_,f.apiUrl+"api/university",n),_.value.status===201){await M();const s={act_description:"Ajout de l'université "+n.univ_name+" ("+n.univ_city+").",acc_id:N.login,univ_id:1};await m("POST",!1,_,f.apiUrl+"api/action",s)}}async function R(n,s,y){if(await m("DELETE",!0,_,f.apiUrl+"api/university/deletebyid/"+n),_.value.status==202){const b={act_description:"Suppression de l'université "+s+" ("+y+").",acc_id:N.login,univ_id:n};await m("POST",!1,_,f.apiUrl+"api/action",b)}M()}const E=O(()=>T.value.agreements.filter(n=>n.university&&n.university.univ_id===c.value.univ_id));function W(n){const s=x.value.find(y=>y.parco_name===n);return s?s.parco_code:"Code non disponible"}function X(n){c.value=n,document.getElementById("confirmModal").showModal()}function Y(){document.getElementById("confirmModal").close()}function Z(){o.value.univ_name="",o.value.univ_city="",o.value.parco_id="",o.value.newparco={parco_name:"",parco_code:""},o.value.parco_id=document.querySelector("#partnercountry_select").options[0].value}async function M(){S.value=!1,await m("GET",!1,P,f.apiUrl+"api/university"),await m("GET",!1,x,f.apiUrl+"api/partnercountry"),await m("GET",!1,T,f.apiUrl+"api/agreement"),S.value=!0,await le(),Z()}function ee(){v.value=[]}return ne(M),(n,s)=>{var y,b,L;return i(),a("div",null,[S.value?(i(),a("div",re,[e("div",ce,[e("div",ue,[de,e("form",{onSubmit:$(Q,["prevent"]),class:"w-2/5 *:my-2"},[e("label",pe,[p(e("input",{type:"text",placeholder:"Nom de l'université","onUpdate:modelValue":s[0]||(s[0]=t=>o.value.univ_name=t),class:"input input-bordered w-full my-1"},null,512),[[w,o.value.univ_name]]),p(e("input",{type:"text",placeholder:"Nom de la ville","onUpdate:modelValue":s[1]||(s[1]=t=>o.value.univ_city=t),class:"input input-bordered w-full my-1"},null,512),[[w,o.value.univ_city]]),p(e("select",{class:"select select-bordered w-full select-primary",id:"partnercountry_select","onUpdate:modelValue":s[2]||(s[2]=t=>o.value.parco_id=t)},[ve,_e,(i(!0),a(C,null,U(x.value,(t,u)=>(i(),a("option",{key:u,value:t.parco_id},l(t.parco_name),9,me))),128))],512),[[F,o.value.parco_id]]),o.value.parco_id==="addNew"?(i(),a("span",fe,[p(e("input",{placeholder:"Nouveau pays (ex: France)","onUpdate:modelValue":s[3]||(s[3]=t=>o.value.newparco.parco_name=t),class:"input input-bordered w-5/6 my-1"},null,512),[[w,o.value.newparco.parco_name]]),p(e("input",{type:"text",placeholder:"Code pays (ex: fr, de, it)","onUpdate:modelValue":s[4]||(s[4]=t=>o.value.newparco.parco_code=t),class:"input input-bordered w-5/6 my-1"},null,512),[[w,o.value.newparco.parco_code]])])):B("",!0)]),ye],32)])]),he,e("div",be,[we,e("p",null,l(z.value.length)+" résultats ("+l(v.value.length)+" filtre"+l(v.value.length>1?"s":"")+")",1),e("div",null,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[5]||(s[5]=t=>G("pays"))},[e("p",null,"Pays ("+l(v.value.length)+" séléctionné"+l(v.value.length>1?"s":"")+")",1),e("span",{class:A([j.value.pays?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),p(e("div",xe,[e("button",{class:"hover:opacity-70 underline",onClick:ee},"Tout désélectionner"),e("div",ge,[(i(!0),a(C,null,U(x.value,(t,u)=>(i(),a("div",{key:u,class:"flex items-center hover:opacity-60 my-1 w-1/2 sm:w-1/3 lg:w-1/4 xl:w-1/5"},[p(e("input",{id:"filt_pays_"+u,type:"checkbox",class:"checkbox",value:t.parco_name,"onUpdate:modelValue":s[6]||(s[6]=h=>v.value=h)},null,8,ke),[[ie,v.value]]),e("label",{for:"filt_pays_"+u,class:"flex w-full items-center cursor-pointer pl-2"},[e("span",{class:A(["fi mr-1","fi-"+t.parco_code])},null,2),e("label",{for:"filt_pays_"+u,class:"select-none w-full cursor-pointer"},l(t.parco_name),9,Ue)],8,Ce)]))),128))])],512),[[se,j.value.pays]])])]),e("div",Ae,[(i(!0),a(C,null,U(z.value,(t,u)=>{var h,g,k;return i(),a("div",{key:u,class:"bg-base-300 min-h-40 p-3 my-2 min-w-96 max-w-96 relative"},[e("span",je,[e("div",Me,[e("span",{class:A(["fi text-2xl","fi-"+(((h=t.partnercountry)==null?void 0:h.parco_code)||"")])},null,2),(g=t.partnercountry)!=null&&g.parco_code?B("",!0):(i(),a("span",Ve," ? ")),e("p",Ne,l(((k=t.partnercountry)==null?void 0:k.parco_name)??"Pays indisponible"),1)]),e("div",Se,[e("label",{for:"modal_modif",class:"hover:opacity-70 hover:cursor-pointer bg-base-300 flex items-center justify-center p-3",onClick:V=>H(t)},Be,8,Te),e("button",{class:"hover:opacity-70 p-3 hover:cursor-pointer bg-base-300",onClick:V=>X(t)},Pe,8,De)])]),e("p",ze,[e("strong",null,l(t.univ_name?t.univ_name:"Nom université indisponible"),1),D(" à "+l(t.univ_city?t.univ_city:"Nom ville indisponible"),1)]),e("p",null,"Nombre d'accords relié à cette Université: "+l(K(t.univ_id)),1)])}),128))]),Le,e("div",Ie,[e("div",Oe,[e("h3",$e,"Modification de l'université n° "+l(r.value.univ_id),1),e("form",{onSubmit:$(J,["prevent"]),class:"w-full"},[e("label",Fe,[Ge,p(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":s[7]||(s[7]=t=>r.value.univ_name=t)},null,512),[[w,r.value.univ_name]])]),e("label",He,[Je,p(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":s[8]||(s[8]=t=>r.value.univ_city=t)},null,512),[[w,r.value.univ_city]])]),e("label",Ke,[Qe,p(e("select",{class:"select select-bordered w-full select-primary",id:"partnercountry_select","onUpdate:modelValue":s[9]||(s[9]=t=>r.value.parco_id=t)},[Re,(i(!0),a(C,null,U(x.value,(t,u)=>(i(),a("option",{key:u,value:t.parco_id},l(t.parco_name),9,We))),128))],512),[[F,r.value.parco_id]])]),Xe],32)])]),e("dialog",Ye,[e("div",Ze,[et,e("div",tt,[nt,st,e("div",ot,[e("span",lt,[e("div",it,[e("span",{class:A(["fi text-2xl","fi-"+(((y=c.value.partnercountry)==null?void 0:y.parco_code)||"")])},null,2),(b=c.value.partnercountry)!=null&&b.parco_code?B("",!0):(i(),a("span",at," ? ")),e("p",rt,l(((L=c.value.partnercountry)==null?void 0:L.parco_name)??"Pays indisponible"),1)])]),e("p",ct,[e("strong",null,l(c.value.univ_name?c.value.univ_name:"Nom université indisponible"),1),D(" à "+l(c.value.univ_city?c.value.univ_city:"Nom ville indisponible"),1)])]),e("div",ut,[e("h4",dt,"Accords liés à cette université ("+l(E.value.length)+"):",1),e("div",pt,[E.value.length>0?(i(!0),a(C,{key:0},U(E.value,(t,u)=>{var h,g,k,V,I;return i(),a("div",{key:u,class:"bg-base-300 my-1 p-3"},[e("span",vt,[e("span",{class:A(["fi text-xl transition-all duration-100 ease-in-out","fi-"+W(t.partnercountry.parco_name)])},null,2)]),e("div",_t,[e("p",mt,[D("("+l(t.partnercountry.parco_name)+") ",1),e("span",ft,l(((h=t.university)==null?void 0:h.univ_city)??"Aucune ville")+" - "+l(((g=t.university)==null?void 0:g.univ_name)??"Aucune université"),1)]),e("p",null,"("+l(((k=t.isced)==null?void 0:k.isc_code)??"??")+") - "+l(((V=t.isced)==null?void 0:V.isc_name)??"ISCED indisponible")+" | "+l(((I=t.component)==null?void 0:I.comp_name)??"Aucune composante"),1)])])}),128)):(i(),a("div",yt,bt))])])]),e("div",wt,[e("button",{class:"btn btn-error",onClick:Y},"Annuler"),e("button",{class:"btn btn-success",onClick:s[10]||(s[10]=t=>R(c.value.univ_id,c.value.univ_name,c.value.univ_city))},"Confirmer")])])],512)])):(i(),oe(ae,{key:1}))])}}};export{kt as default};
