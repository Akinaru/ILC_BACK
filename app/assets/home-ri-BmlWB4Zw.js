import{k as U,r as d,o as $,c as V,d as n,e as l,f as M,J as q,g as t,F as z,t as B,B as u,z as C,q as E,v as F,I as j,y as A,h as _,i as m,u as y,L as N,j as R}from"./index-WfzvT7mn.js";import{g}from"./actionType-CQghQJMu.js";const G={key:0},I={key:0,class:"flex lg:flex-row flex-col"},J={class:"px-3 w-full"},P=t("p",null,"Vos 5 dernières actions:",-1),Y={class:"ml-2"},O={class:"ml-2"},H={key:1},K=t("p",null,"Aucune action.",-1),Q=[K],W={class:"flex items-center justify-center flex-col pt-5"},X=t("p",null,"Date limite des voeux:",-1),Z={class:"flex items-center justify-start bg-base-300 w-fit p-3"},tt={class:"flex py-3 pr-3"},et={class:"font-bold"},st={class:"mx-2"},at=t("label",{for:"modal_date",class:"btn btn-primary hover:scale-105 transition-all hover:opacity-70"},"Modifier",-1),ot=t("input",{type:"checkbox",id:"modal_date",class:"modal-toggle"},null,-1),it={class:"modal",role:"dialog"},nt={class:"modal-box"},lt=t("h3",{class:"font-bold text-lg"},"Modification date limite",-1),ct=t("div",{class:"modal-action"},[t("button",{type:"submit"},[t("label",{for:"modal_date",class:"btn btn-success"},"Valider")]),t("label",{for:"modal_date",class:"btn"},"Annuler")],-1),rt={class:"w-fit flex items-center justify-center flex-col md:py-10"},dt=t("p",{class:"py-4"},"Avancement des étapes actuelles:",-1),ut={class:"steps steps-vertical sm:steps-horizontal max-w-lg"},_t=t("li",{class:"step step-primary"},"Inscriptions",-1),mt=t("li",{class:"step step-primary"},"Choix des voeux",-1),pt={key:1},yt={__name:"home-ri",setup(ft){const D=U(),p=d([]),x=d([]),c=d([]),v=d(!1),r=d(null),h=d([]);async function b(){v.value=!1,await _("GET",!1,p,m.apiUrl+"api/event"),await _("GET",!1,x,m.apiUrl+"api/action/getbylogin/"+D.login),await _("GET",!1,c,m.apiUrl+"api/admin"),r.value=k(c.value.adm_datelimite),v.value=!0}$(b);const w=V(()=>x.value.slice(0,5));function L(s){return i(s)==0?"ajourd'hui":i(s)==1?"demain":i(s)<0?"il y a "+-i(s)+" jour"+(-i(s)>1?"s":""):"("+i(s)+" jours restants)"}function i(s){const o=new Date(s)-new Date;return Math.ceil(o/(1e3*60*60*24))}function S(s){const a=new Date(s),e=a.getDate().toString().padStart(2,"0"),o=(a.getMonth()+1).toString().padStart(2,"0"),f=a.getFullYear();return`${e}/${o}/${f}`}async function T(){if(new Date(r.value)<new Date){R("error",{data:{error:"Le jour que vous avez choisi est déjà passé. Action annulée."}}),r.value=k(c.value.adm_datelimite);return}const e={adm_datelimite:r.value};if(await _("PUT",!0,h,m.apiUrl+"api/admin",e),h.value.status==200){const o={act_description:"Modification administration: Nouvelle date limite des voeux: "+S(e.adm_datelimite),acc_id:D.login,admin:1};await _("POST",!1,h,m.apiUrl+"api/action",o)}b()}function k(s){const a=new Date(s),e=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0"),f=String(a.getDate()).padStart(2,"0");return`${e}-${o}-${f}`}return(s,a)=>v.value?(n(),l("div",G,[p.value&&p.value.count>0?(n(),l("div",I,[M(q,{events:p.value},null,8,["events"]),t("div",J,[t("div",null,[P,w.value.length>0?(n(!0),l(z,{key:0},B(w.value,(e,o)=>(n(),l("div",{key:o,class:"flex py-2"},[y(g)(e.act_type)?(n(),l("span",{key:0,class:j(["min-w-32",["badge",y(g)(e.act_type).color]])},u(y(g)(e.act_type).name),3)):A("",!0),t("p",Y,u(e.act_date),1),t("p",O,u(e.act_description),1)]))),128)):(n(),l("div",H,Q))]),t("div",W,[X,t("div",Z,[t("div",tt,[t("p",et,u(S(c.value.adm_datelimite)),1),t("p",st,u(L(c.value.adm_datelimite)),1)]),at,ot,t("div",it,[t("div",nt,[lt,t("form",{onSubmit:C(T,["prevent"]),class:"w-full"},[E(t("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),class:"input input-bordered w-full my-3"},null,512),[[F,r.value]]),ct],32)])])]),t("div",rt,[dt,t("ul",ut,[_t,mt,t("li",{class:j(["step",{"step-primary":i(c.value.adm_datelimite)<0}])},"Arbitrage",2)])])])])])):A("",!0)])):(n(),l("div",pt,[M(N)]))}};export{yt as default};
