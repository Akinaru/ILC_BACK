import{k as F,r as f,o as G,d as r,e as i,g as e,f as J,u as K,z as j,q as d,s as Q,F as g,t as U,v as u,y as D,B as m,C as S,A as E,h as v,i as p,j as y}from"./index-B86mjc3y.js";import{_ as R}from"./ExportComp-ok2yJOO3.js";const W={class:"flex justify-between"},X=e("p",{class:"text-xl font-bold"},"Departement",-1),Y={class:"flex *:mx-1"},Z={class:"m-5"},ee={class:"m-5 flex justify-center items-center flex-col"},oe=e("p",{class:"text-lg font-bold"},"Ajout département",-1),te={class:"form-control w-full"},ne=e("div",{class:"label"},[e("span",{class:"label-text"},"Composante")],-1),se=e("option",{disabled:"",selected:""},"Selectionnez une composante",-1),le=["value"],ae=e("option",{value:"addNew"},"Créer une composante",-1),re={key:0,class:"form-control w-5/6 my-1 flex flex-col justify-center items-center"},ie=e("div",{class:"label"},[e("span",{class:"label-text"},"Créer une composante")],-1),ce={class:"w-full flex items-center justify-between"},de=e("label",{for:"colorPicker",class:"label-text"},"Couleur",-1),ue=e("div",{class:"flex items-center justify-center"},[e("button",{class:"btn btn-primary hover:scale-105 transition-all hover:opacity-70",type:"submit"},"Ajouter le département")],-1),me=e("p",{class:"text-lg font-bold"},"Liste des composantes (et de leurs départements)",-1),pe={key:0,class:"my-5"},_e={key:0},ve={class:"flex"},fe={class:"p-5 bg-base-300 w-full"},he={class:"font-bold"},be=["onClick"],we=e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20,16v4a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V6A2,2,0,0,1,4,4H8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"}),e("polygon",{fill:"none",points:"12.5 15.8 22 6.2 17.8 2 8.3 11.5 8 16 12.5 15.8",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),ye=[we],xe=["onClick"],ge=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ke=[ge],Ce={class:"bg-base-300 w-full p-5 flex items-center justify-center"},Me=["data-tip","onClick"],je={class:"w-full"},Ue=["onClick"],Ae=e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20,16v4a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V6A2,2,0,0,1,4,4H8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"}),e("polygon",{fill:"none",points:"12.5 15.8 22 6.2 17.8 2 8.3 11.5 8 16 12.5 15.8",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),Ve=[Ae],De=["onClick"],Se=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Ee=[Se],Ne={key:0,class:"list-disc mx-10 my-5"},Te={key:1},ze=e("p",null,"Aucune composante trouvée.",-1),Be=[ze],qe={id:"confirmModalCompo",ref:"confirmModalCompo",class:"modal"},Pe={class:"modal-box"},$e=e("h3",{class:"text-lg font-bold"},"Confirmer la suppression ?",-1),Ie={class:"py-3"},Le=e("p",null,"Confirmez vous la supression de la composante:",-1),He={class:"modal-action"},Oe={id:"confirmModal",ref:"confirmModal",class:"modal"},Fe={class:"modal-box"},Ge=e("h3",{class:"text-lg font-bold"},"Confirmer la suppression ?",-1),Je={class:"py-3"},Ke=e("p",null,"Confirmez vous la supression du département:",-1),Qe={class:"modal-action"},Re={key:1,class:"flex items-center justify-center my-20"},We=e("span",{class:"loading loading-dots loading-lg"},null,-1),Xe=[We],Ye=e("input",{type:"checkbox",id:"modal_modif",class:"modal-toggle"},null,-1),Ze={class:"modal modal-bottom sm:modal-middle",role:"dialog"},eo={class:"modal-box"},oo={class:"font-bold text-lg"},to={class:"form-control w-full"},no=e("div",{class:"label"},[e("span",{class:"label-text"},"Nom")],-1),so={class:"form-control w-full"},lo=e("div",{class:"label"},[e("span",{class:"label-text"},"Nom raccourci")],-1),ao={class:"form-control w-full"},ro=e("div",{class:"label"},[e("span",{class:"label-text"},"Couleur")],-1),io=e("div",{class:"modal-action"},[e("label",{for:"modal_modif",class:"btn"},"Annuler"),e("button",{type:"submit"},[e("label",{for:"modal_modif",class:"btn btn-success"},"Enregistrer")])],-1),co=e("input",{type:"checkbox",id:"modal_modif_comp",class:"modal-toggle"},null,-1),uo={class:"modal modal-bottom sm:modal-middle",role:"dialog"},mo={class:"modal-box"},po={class:"font-bold text-lg"},_o={class:"form-control w-full"},vo=e("div",{class:"label"},[e("span",{class:"label-text"},"Nom")],-1),fo={class:"form-control w-full"},ho=e("div",{class:"label"},[e("span",{class:"label-text"},"Nom raccourci")],-1),bo=e("div",{class:"modal-action"},[e("label",{for:"modal_modif_comp",class:"btn"},"Annuler"),e("button",{type:"submit"},[e("label",{for:"modal_modif_comp",class:"btn btn-success"},"Enregistrer")])],-1),go={__name:"departement",setup(wo){const k=F(),h=f([]),a=f([]),l=f([]),c=f([]),b=f([]),C=f([]),n=f({name:"",shortname:"",color:"#9e9e9e",compo:"",newcompo:{name:null,shortname:null}});async function N(){const s={dept_name:n.value.name,dept_shortname:n.value.shortname.toUpperCase(),dept_color:n.value.color};if(n.value.compo=="Selectionnez une composante"){y("error",{data:{error:"Vous devez choisir une composante.",message:"Ajout du département annulé."}});return}else if(n.value.compo!=="addNew")s.comp_id=n.value.compo;else{if(!n.value.newcompo.name||n.value.newcompo.name===""){y("error",{data:{error:"Vous devez mettre un nom à votre composante.",message:"Ajout du département annulé."}});return}else if(!n.value.newcompo.shortname||n.value.newcompo.shortname===""){y("error",{data:{error:"Vous devez mettre un nom raccourci à votre composante.",message:"Ajout du département annulé."}});return}s.newcompo={comp_name:n.value.newcompo.name,comp_shortname:n.value.newcompo.shortname.toUpperCase()}}if(n.value.name==""){y("error",{data:{error:"Vous devez mettre un nom à votre département.",message:"Ajout du département annulé."}});return}if(n.value.shortname==""){y("error",{data:{error:"Vous devez mettre un nom raccourci à votre département.",message:"Ajout du département annulé."}});return}if(await v("POST",!0,a,p.apiUrl+"api/department",s),a.value.status==201){const o={act_description:"Ajout du département "+n.value.shortname+".",acc_id:k.login,dept_id:a.value.department.dept_id};await v("POST",!1,a,p.apiUrl+"api/action",o)}await w(),A()}function T(s){b.value=s,document.getElementById("confirmModal").showModal()}function z(s){C.value=s,document.getElementById("confirmModalCompo").showModal()}function x(){document.getElementById("confirmModal").close(),document.getElementById("confirmModalCompo").close()}function B(s){l.value.dept_id=s.dept_id,l.value.dept_name=s.dept_name,l.value.dept_shortname=s.dept_shortname,l.value.dept_color=s.dept_color}function q(s){c.value.comp_id=s.comp_id,c.value.comp_name=s.comp_name,c.value.comp_shortname=s.comp_shortname}async function P(){const s={dept_id:l.value.dept_id,dept_name:l.value.dept_name,dept_shortname:l.value.dept_shortname,dept_color:l.value.dept_color};if(await v("PUT",!0,a,p.apiUrl+"api/department",s),a.value.status==200){const o={act_description:"Modification du département "+s.dept_shortname+".",acc_id:k.login,dept_id:a.value.department.dept_id};await v("POST",!1,a,p.apiUrl+"api/action",o)}w()}async function $(){const s={comp_id:c.value.comp_id,comp_name:c.value.comp_name,comp_shortname:c.value.comp_shortname};await v("PUT",!0,a,p.apiUrl+"api/component",s),w()}async function I(s,o){if(x(),await v("DELETE",!0,a,p.apiUrl+"api/department/deletebyid/"+o),a.value.status==202){const t={act_description:"Suppression du département "+s+".",acc_id:k.login,dept_id:o};await v("POST",!1,a,p.apiUrl+"api/action",t)}w()}async function L(s){x(),await v("DELETE",!0,a,p.apiUrl+"api/component/deletebyid/"+s),w()}async function w(){await v("GET",!1,h,p.apiUrl+"api/component"),A()}function A(){n.value.name="",n.value.shortname="",n.value.color="#9e9e9e",n.value.compo=document.querySelector(".select").options[0].value,n.value.newcompo.shortname="",n.value.newcompo.name=""}function H(s){navigator.clipboard.writeText(s)}return G(w),(s,o)=>(r(),i(g,null,[e("div",null,[e("div",W,[X,e("div",Y,[J(R,{texte:"Exporter des départements en csv",link:K(p).apiUrl+"api/department/export"},null,8,["link"])])]),e("div",Z,[e("div",ee,[oe,e("form",{onSubmit:j(N,["prevent"]),class:"w-2/5 *:my-2 flex flex-col justify-center items-center"},[e("label",te,[ne,d(e("select",{class:"select select-bordered w-full","onUpdate:modelValue":o[0]||(o[0]=t=>n.value.compo=t)},[se,(r(!0),i(g,null,U(h.value.components,(t,M)=>(r(),i("option",{key:M,value:t.comp_id},m(t.comp_name),9,le))),128)),ae],512),[[Q,n.value.compo]])]),n.value.compo==="addNew"?(r(),i("label",re,[ie,d(e("input",{type:"text",placeholder:"Nom (ex: IUT Annecy)","onUpdate:modelValue":o[1]||(o[1]=t=>n.value.newcompo.name=t),class:"input input-bordered w-full"},null,512),[[u,n.value.newcompo.name]]),d(e("input",{type:"text",placeholder:"Nom raccourci (ex: IUT-A)","onUpdate:modelValue":o[2]||(o[2]=t=>n.value.newcompo.shortname=t),class:"input input-bordered w-full"},null,512),[[u,n.value.newcompo.shortname]])])):D("",!0),e("div",ce,[de,d(e("input",{type:"color",id:"colorPicker","onUpdate:modelValue":o[3]||(o[3]=t=>n.value.color=t)},null,512),[[u,n.value.color]])]),d(e("input",{type:"text",placeholder:"Nom","onUpdate:modelValue":o[4]||(o[4]=t=>n.value.name=t),class:"input input-bordered w-full"},null,512),[[u,n.value.name]]),d(e("input",{type:"text",placeholder:"Nom raccourci","onUpdate:modelValue":o[5]||(o[5]=t=>n.value.shortname=t),class:"input input-bordered w-full"},null,512),[[u,n.value.shortname]]),ue],32)])]),e("div",null,[me,h.value&&h.value.components?(r(),i("div",pe,[h.value.count>0?(r(),i("div",_e,[(r(!0),i(g,null,U(h.value.components,(t,M)=>(r(),i("div",{key:M},[e("div",ve,[e("p",fe,[e("span",he,m(t.comp_name),1),E(" ("+m(t.comp_shortname)+")",1)]),e("label",{for:"modal_modif_comp",class:"hover:opacity-60 hover:cursor-pointer bg-base-300 flex items-center justify-center p-5",onClick:_=>q(t)},ye,8,be),e("button",{class:"hover:opacity-60 hover:cursor-pointer bg-base-300 flex items-center justify-center p-5",onClick:_=>z(t)},ke,8,xe)]),(r(!0),i(g,null,U(t.departments,(_,O)=>(r(),i("div",{key:O,class:"mx-10 flex m-1"},[e("div",Ce,[e("div",{class:"h-10 w-10 mx-5 tooltip hover:opacity-80 hover:cursor-pointer","data-tip":`${_.dept_color} Cliquez pour copier`,onClick:V=>H(_.dept_color),style:S({backgroundColor:_.dept_color})},null,12,Me),e("p",je,m(_.dept_name)+" ("+m(_.dept_shortname)+")",1)]),e("label",{for:"modal_modif",class:"hover:opacity-60 hover:cursor-pointer bg-base-300 flex items-center justify-center p-5",onClick:V=>B(_)},Ve,8,Ue),e("button",{class:"hover:opacity-60 hover:cursor-pointer bg-base-300 flex items-center justify-center p-5",onClick:V=>T(_)},Ee,8,De)]))),128)),t.departments.length==0?(r(),i("p",Ne,"Aucun département")):D("",!0)]))),128))])):(r(),i("div",Te,Be)),e("dialog",qe,[e("div",Pe,[$e,e("div",Ie,[Le,e("strong",null,m(C.value.comp_name),1)]),e("div",He,[e("button",{class:"btn btn-error",onClick:x},"Annuler"),e("button",{class:"btn btn-success",onClick:o[6]||(o[6]=t=>L(C.value.comp_id))},"Confirmer")])])],512),e("dialog",Oe,[e("div",Fe,[Ge,e("div",Je,[Ke,e("strong",null,[e("span",{class:"badge p-3",style:S({backgroundColor:b.value.dept_color})},m(b.value.dept_shortname),5),E(" "+m(b.value.dept_name),1)])]),e("div",Qe,[e("button",{class:"btn btn-error",onClick:x},"Annuler"),e("button",{class:"btn btn-success",onClick:o[7]||(o[7]=t=>I(b.value.dept_shortname,b.value.dept_id))},"Confirmer")])])],512)])):(r(),i("div",Re,Xe))])]),e("div",null,[Ye,e("div",Ze,[e("div",eo,[e("h3",oo,"Modification du département n° "+m(l.value.dept_id),1),e("form",{onSubmit:j(P,["prevent"]),class:"w-full"},[e("label",to,[no,d(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":o[8]||(o[8]=t=>l.value.dept_name=t)},null,512),[[u,l.value.dept_name]])]),e("label",so,[lo,d(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":o[9]||(o[9]=t=>l.value.dept_shortname=t)},null,512),[[u,l.value.dept_shortname]])]),e("label",ao,[ro,d(e("input",{type:"color",id:"colorPicker","onUpdate:modelValue":o[10]||(o[10]=t=>l.value.dept_color=t)},null,512),[[u,l.value.dept_color]])]),io],32)])]),co,e("div",uo,[e("div",mo,[e("h3",po,"Modification de la composante n° "+m(c.value.comp_id),1),e("form",{onSubmit:j($,["prevent"]),class:"w-full"},[e("label",_o,[vo,d(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":o[11]||(o[11]=t=>c.value.comp_name=t)},null,512),[[u,c.value.comp_name]])]),e("label",fo,[ho,d(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":o[12]||(o[12]=t=>c.value.comp_shortname=t)},null,512),[[u,c.value.comp_shortname]])]),bo],32)])])])],64))}};export{go as default};
