import{k as O,r,c as G,o as $,d as u,e as m,g as e,z as I,q as h,v as b,F as M,t as E,B as n,E as F,h as c,i as d,n as H,A as S,I as J,j as U,L as K}from"./index-WfzvT7mn.js";const Q={key:0},R={class:"m-5 my-20"},W={class:"m-5 flex justify-center items-center flex-col"},X=e("p",{class:"text-lg font-bold"},"Ajout Isced",-1),Y={class:"form-control w-full items-center justify-center"},Z=e("div",{class:"flex items-center justify-center"},[e("button",{class:"btn btn-primary hover:scale-105 transition-all hover:opacity-70",type:"submit"},"Ajouter l'isced")],-1),ee=e("p",{class:"font-bold text-xl mb-5"},"Liste des ISCED:",-1),se={class:"flex flex-wrap justify-center gap-2"},te={class:"relative flex items—center justify-between"},oe={class:"flex w-full justify-end"},ie=["onClick"],ne=e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20,16v4a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V6A2,2,0,0,1,4,4H8",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"}),e("polygon",{fill:"none",points:"12.5 15.8 22 6.2 17.8 2 8.3 11.5 8 16 12.5 15.8",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),le=[ne],ae=["onClick"],ce=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),de=[ce],re={class:"mt-1"},ue=e("input",{type:"checkbox",id:"modal_modif",class:"modal-toggle"},null,-1),_e={class:"modal modal-bottom sm:modal-middle",role:"dialog"},me={class:"modal-box"},pe={class:"font-bold text-lg"},fe={class:"form-control w-full"},ve=e("div",{class:"label"},[e("span",{class:"label-text"},"Code")],-1),he={class:"form-control w-full"},be=e("div",{class:"label"},[e("span",{class:"label-text"},"Nom")],-1),ye=e("div",{class:"modal-action"},[e("label",{for:"modal_modif",class:"btn"},"Annuler"),e("button",{type:"submit"},[e("label",{for:"modal_modif",class:"btn btn-success"},"Enregistrer")])],-1),we={id:"confirmModal",ref:"confirmModal",class:"modal"},xe={class:"modal-box"},ge=e("h3",{class:"text-lg font-bold"},"Confirmer la suppression ?",-1),ke={class:"py-3"},Ce=e("p",null,"Confirmez vous la supression de l'isced:",-1),Ae=e("p",null,"Cette action entraînera la suppression de l'ISCED dans tous les accords qui y sont liés.",-1),je={class:"bg-base-300 p-3 my-2 relative"},Ie={class:"mt-1"},Me={class:"py-3"},Ee={class:"text-lg font-bold"},Se={class:"flex flex-col w-full max-h-64 overflow-y-auto"},Ue={class:"mr-2 flex items-center justify-start"},De={class:"flex flex-col"},Te={class:"w-full select-none"},Be={class:"font-bold"},Ve={key:1},qe=e("p",{class:"text-center my-5"},"Aucun accords",-1),Le=[qe],ze={class:"modal-action"},Oe={__name:"isced",setup(Ne){const y=O(),w=r(!1),x=r([]),g=r([]),C=r([]),_=r([]),a=r([]),i=r([]),l=r({isc_code:"",isc_name:""});function D(s){i.value.isc_id=s.isc_id,i.value.isc_name=s.isc_name,i.value.isc_code=s.isc_code}async function T(){const s={isc_id:i.value.isc_id,isc_name:i.value.isc_name,isc_code:i.value.isc_code};if(await c("PUT",!0,a,d.apiUrl+"api/isced",s),a.value.status==200){const t={act_description:"Modification de l'isced ("+s.isc_code+") "+s.isc_name+".",acc_id:y.login,isc_id:s.isc_id};await c("POST",!1,a,d.apiUrl+"api/action",t)}f()}async function B(){if(l.value.isc_name==""){U("error",{data:{error:"Vous devez choisir un nom d'isced.",message:"Ajout de l'isced annulé."}});return}if(l.value.isc_code==""){U("error",{data:{error:"Vous devez choisir un code.",message:"Ajout de l'isced annulé."}});return}const s={isc_name:l.value.isc_name,isc_code:l.value.isc_code};if(await c("POST",!0,a,d.apiUrl+"api/isced",s),a.value.status===201){await f();const t={act_description:"Ajout de l'isced ("+s.isc_code+") "+s.isc_name+".",acc_id:y.login,isc_id:1};await c("POST",!1,a,d.apiUrl+"api/action",t)}}async function V(s,t,o){if(await c("DELETE",!0,a,d.apiUrl+"api/isced/deletebyid/"+s),a.value.status==202){const p={act_description:"Suppression de l'université ("+o+") "+t+".",acc_id:y.login,isc_id:s};await c("POST",!1,a,d.apiUrl+"api/action",p)}f()}function q(s){_.value=s,document.getElementById("confirmModal").showModal()}function L(){document.getElementById("confirmModal").close()}function z(){l.value.isc_name="",l.value.isc_code=""}function N(s){return g.value.agreements.filter(t=>t.isced&&t.isced.isc_id===s).length}function P(s){const t=C.value.find(o=>o.parco_name===s);return t?t.parco_code:"Code non disponible"}const k=G(()=>g.value.agreements.filter(s=>s.isced&&s.isced.isc_id===_.value.isc_id));async function f(){w.value=!1,await c("GET",!1,x,d.apiUrl+"api/isced"),await c("GET",!1,g,d.apiUrl+"api/agreement"),await c("GET",!1,C,d.apiUrl+"api/partnercountry"),x.value.sort((s,t)=>s.isc_code.localeCompare(t.isc_code)),w.value=!0,await H(),z()}return $(f),(s,t)=>(u(),m("div",null,[w.value?(u(),m("div",Q,[e("div",R,[e("div",W,[X,e("form",{onSubmit:I(B,["prevent"]),class:"w-2/5 *:my-2"},[e("label",Y,[h(e("input",{type:"text",placeholder:"Code de l'isced (ex: 071)","onUpdate:modelValue":t[0]||(t[0]=o=>l.value.isc_code=o),class:"input input-bordered w-full my-1"},null,512),[[b,l.value.isc_code]]),h(e("input",{type:"text",placeholder:"Nom de l'isced","onUpdate:modelValue":t[1]||(t[1]=o=>l.value.isc_name=o),class:"input input-bordered w-full my-1"},null,512),[[b,l.value.isc_name]])]),Z],32)])]),ee,e("div",se,[(u(!0),m(M,null,E(x.value,(o,p)=>(u(),m("div",{key:p,class:"bg-base-300 min-h-30 p-3 my-2 min-w-96 max-w-96 relative"},[e("span",te,[e("div",oe,[e("label",{for:"modal_modif",class:"hover:opacity-70 hover:cursor-pointer bg-base-300 flex items-center justify-center p-3",onClick:v=>D(o)},le,8,ie),e("button",{class:"hover:opacity-70 p-3 hover:cursor-pointer bg-base-300",onClick:v=>q(o)},de,8,ae)])]),e("p",re,[S(n(o.isc_code)+" - ",1),e("strong",null,n(o.isc_name),1)]),e("p",null,"Nombre d'accords relié à cet ISCED: "+n(N(o.isc_id)),1)]))),128))]),ue,e("div",_e,[e("div",me,[e("h3",pe,"Modification de l'isced n° "+n(i.value.isc_id),1),e("form",{onSubmit:I(T,["prevent"]),class:"w-full"},[e("label",fe,[ve,h(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":t[2]||(t[2]=o=>i.value.isc_code=o)},null,512),[[b,i.value.isc_code]])]),e("label",he,[be,h(e("input",{type:"text",class:"input input-bordered w-full","onUpdate:modelValue":t[3]||(t[3]=o=>i.value.isc_name=o)},null,512),[[b,i.value.isc_name]])]),ye],32)])]),e("dialog",we,[e("div",xe,[ge,e("div",ke,[Ce,Ae,e("div",je,[e("p",Ie,"("+n(_.value.isc_code)+") - "+n(_.value.isc_name),1)]),e("div",Me,[e("h4",Ee,"Accords liés à cet ISCED ("+n(k.value.length)+"):",1),e("div",Se,[k.value.length>0?(u(!0),m(M,{key:0},E(k.value,(o,p)=>{var v,A,j;return u(),m("div",{key:p,class:"bg-base-300 my-1 p-3"},[e("span",Ue,[e("span",{class:J(["fi text-xl transition-all duration-100 ease-in-out","fi-"+P(o.partnercountry.parco_name)])},null,2)]),e("div",De,[e("p",Te,[S("("+n(o.partnercountry.parco_name)+") ",1),e("span",Be,n(((v=o.university)==null?void 0:v.univ_city)??"Aucune ville")+" - "+n(((A=o.university)==null?void 0:A.univ_name)??"Aucune université"),1)]),e("p",null,n(((j=o.component)==null?void 0:j.comp_name)??"Aucune composante"),1)])])}),128)):(u(),m("div",Ve,Le))])])]),e("div",ze,[e("button",{class:"btn btn-error",onClick:L},"Annuler"),e("button",{class:"btn btn-success",onClick:t[4]||(t[4]=o=>V(_.value.isc_id,_.value.isc_name,_.value.isc_code))},"Confirmer")])])],512)])):(u(),F(K,{key:1}))]))}};export{Oe as default};
