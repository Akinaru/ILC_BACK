import{k as W,r as _,c as P,o as X,b as ee,d as l,e as a,g as e,f as S,w as j,B as o,I as L,q as d,M as B,x as b,F as T,t as z,y as V,A as r,C as D,v as te,h as A,i as g,L as se}from"./index-B86mjc3y.js";import{_ as oe}from"./ExportComp-ok2yJOO3.js";const ne={class:"text-sm breadcrumbs font-bold"},le={key:0,class:"flex"},ae={class:"bg-base-200 min-w-72 h-fit min-h-screen drop-shadow-lg"},ce=e("p",{class:"bg-base-300 p-3 flex items-center justify-center font-bold text-lg"},"Filtres",-1),ie={key:0},re={class:"p-1"},ue={class:"flex items-center hover:opacity-60 my-1"},de=e("label",{for:"filt_dept_zero",class:"flex items-center justify-center w-full cursor-pointer pl-2"},[e("div",{class:"w-3 h-3 mr-1",style:{backgroundColor:"#aaaaaa"}}),e("label",{for:"filt_dept_zero",class:"select-none w-full cursor-pointer"},"Aucun")],-1),pe=["id","value"],_e=["for"],me=["for"],ve={class:"p-1"},he={class:"flex items-center hover:opacity-60 my-1"},fe=e("label",{for:"filt_voeux_1",class:"select-none w-full cursor-pointer pl-2"},"Aucun",-1),xe={class:"flex items-center hover:opacity-60 my-1"},be=e("label",{for:"filt_voeux_2",class:"select-none w-full cursor-pointer pl-2"},"Au moins un",-1),ye={class:"p-1"},ge={class:"flex items-center hover:opacity-60 my-1"},we=e("label",{for:"filt_document_1",class:"select-none w-full cursor-pointer pl-2"},"0",-1),ke={class:"flex items-center hover:opacity-60 my-1"},Ce=e("label",{for:"filt_document_2",class:"select-none w-full cursor-pointer pl-2"},"1",-1),De={class:"flex items-center hover:opacity-60 my-1"},Ae=e("label",{for:"filt_document_2",class:"select-none w-full cursor-pointer pl-2"},"2",-1),Me={class:"flex items-center hover:opacity-60 my-1"},Se=e("label",{for:"filt_document_3",class:"select-none w-full cursor-pointer pl-2"},"3",-1),Ue={key:0,class:"w-full px-10"},Ve={class:"w-full flex items-center justify-between flex-col md:flex-row"},Ee={class:"text-lg font-semibold"},$e={key:0},je={class:"flex items-center justify-center"},Le=e("div",{class:"dropdown dropdown-end mx-2"},[e("div",{tabindex:"0",role:"button",class:"btn btn-circle btn-ghost btn-xs text-info"},[e("svg",{tabindex:"0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"h-4 w-4 stroke-current text-current"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])]),e("div",{tabindex:"0",class:"card compact dropdown-content bg-base-100 rounded-box z-[1] w-64 shadow"},[e("div",{tabindex:"0",class:"card-body"},[e("h2",{class:"card-title"},"⚠️ Information"),e("p",null,"Les étudiants exportés correspondent aux résultats des filtres.")])])],-1),Be={class:"py-2"},Te={class:"input input-bordered flex items-center gap-2"},ze=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4 opacity-70"},[e("path",{"fill-rule":"evenodd",d:"M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z","clip-rule":"evenodd"})],-1),Ne={class:"flex flex-wrap gap-4 items-center justify-center py-5"},qe=["onClick"],Fe=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Ge=[Fe],Ie={class:"flex-1"},Re={class:"text-xl font-bold mb-2 truncate min-w-72"},Oe={class:"text-gray-600 mb-2 truncate"},Pe={key:1},Qe={class:"mt-4"},Ze={class:"text-sm text-gray-400"},He=e("strong",null,"Nombre de vœux:",-1),Je=e("br",null,null,-1),Ye=e("strong",null,"Documents ajouté(s):",-1),Ke=e("br",null,null,-1),We=e("strong",null,"Dernière connexion:",-1),Xe=e("button",{class:"btn w-full"},"Voir le profil",-1),et={key:1},tt=e("p",null,"Aucun résultat",-1),st=[tt],ot={id:"confirmModal",ref:"confirmModal",class:"modal"},nt={class:"modal-box"},lt=e("h3",{class:"text-lg font-bold"},"Confirmer la suppression ?",-1),at={class:"py-3"},ct=e("p",null,"Confirmez vous la supression de l'étudiant:",-1),it=e("p",null,"Cela entraînera la suppression de ses vœux et de son emplacement dans l'arbitrage.",-1),rt={class:"w-full py-2"},ut={class:"flex-1"},dt={class:"text-xl font-bold mb-2 truncate min-w-72"},pt={class:"text-gray-600 mb-2 truncate"},_t={key:1},mt={class:"mt-4"},vt={class:"text-sm text-gray-400"},ht=e("strong",null,"Nombre de vœux:",-1),ft=e("br",null,null,-1),xt=e("strong",null,"Documents ajouté(s):",-1),bt=e("br",null,null,-1),yt=e("strong",null,"Dernière connexion:",-1),gt={class:"modal-action"},wt={key:1},At={__name:"etudiants",setup(kt){const N=W(),M=_([]),u=_([]),q=_([]),F=_(!1),U=_(""),c=_([]),E=_([]),m=_([]),v=_([]),i=_([]),f=_({voeux:!0,departments:!0,document:!0});function $(n){f.value[n]=!f.value[n]}const w=P(()=>M.value.accounts.filter(n=>{const s=m.value.length===0||n.department&&m.value.includes(n.department.dept_shortname)||m.value.includes("Aucun")&&!n.department,p=n.access===null,x=v.value.length===0||v.value.includes("Aucun")&&n.wishes.count===0||v.value.includes("AuMoinsUn")&&n.wishes.count>0,k=!U.value||n.acc_fullname.toLowerCase().includes(U.value.toLowerCase()),t=n.documents.count||0,h=i.value.length===0||i.value.includes(t.toString());return s&&p&&x&&k&&h}).sort((n,s)=>n.acc_fullname.localeCompare(s.acc_fullname)));async function G(){await A("GET",!1,u,g.apiUrl+"api/account/getbylogin/"+N.login),u.value.access!=null&&u.value.access.acs_accounttype==1?await A("GET",!1,M,g.apiUrl+"api/account"):u.value.access!=null&&u.value.department!=null&&await A("GET",!1,M,g.apiUrl+"api/account/getbydept/"+u.value.department.dept_id),await A("GET",!1,q,g.apiUrl+"api/component"),F.value=!0}function Q(n){c.value=n,document.getElementById("confirmModal").showModal()}function I(){document.getElementById("confirmModal").close()}async function Z(n,s,p){if(I(),await A("DELETE",!0,E,g.apiUrl+"api/account/deletebyid/"+n),E.value.status==202){const x={act_description:"Suppression de l'étudiant "+s+" ("+p+").",acc_id:N.login,acc_id:n};await A("POST",!1,E,g.apiUrl+"api/action",x)}G()}function R(n){const s=new Date(n),p=String(s.getDate()).padStart(2,"0"),x=String(s.getMonth()+1).padStart(2,"0"),k=s.getFullYear(),t=String(s.getHours()).padStart(2,"0"),h=String(s.getMinutes()).padStart(2,"0");return`${p}/${x}/${k} à ${t}h${h}`}const H=P(()=>{const n=w.value.map(p=>p.acc_id),s=new URLSearchParams({ids:JSON.stringify(n)}).toString();return`${g.apiUrl}api/account/export?${s}`});X(G);function J(){m.value=[]}function Y(){v.value=[]}function K(){i.value=[]}return(n,s)=>{var x,k;const p=ee("RouterLink");return l(),a("div",null,[e("div",ne,[e("ul",null,[e("li",null,[S(p,{to:{name:"Dashboard"}},{default:j(()=>[r("Dashboard")]),_:1})]),e("li",null,[S(p,{to:{name:"EtudiantsDash"}},{default:j(()=>[r("Étudiants")]),_:1})])])]),F.value?(l(),a("div",le,[e("div",ae,[ce,u.value.access.acs_accounttype==1?(l(),a("div",ie,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[0]||(s[0]=t=>$("departments"))},[e("p",null,"Départements ("+o(m.value.length)+" séléctionné"+o(m.value.length>1?"s":"")+")",1),e("span",{class:L([f.value.departments?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),d(e("div",re,[e("button",{class:"hover:opacity-70 underline",onClick:J},"Tout désélectionner"),e("div",ue,[d(e("input",{id:"filt_dept_zero",type:"checkbox",class:"checkbox",value:"Aucun","onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t)},null,512),[[b,m.value]]),de]),(l(!0),a(T,null,z(q.value.components,(t,h)=>(l(),a("div",{key:h},[e("p",null,o(t.comp_name),1),(l(!0),a(T,null,z(t.departments,(C,y)=>(l(),a("div",{key:y,class:"flex items-center hover:opacity-60 my-1"},[d(e("input",{id:"filt_dept_"+y,type:"checkbox",class:"checkbox",value:C.dept_shortname,"onUpdate:modelValue":s[2]||(s[2]=O=>m.value=O)},null,8,pe),[[b,m.value]]),e("label",{for:"filt_dept_"+y,class:"cursor-pointer w-full flex items-center justify-center pl-2"},[e("div",{class:"w-3 h-3 mr-1",style:D({backgroundColor:C.dept_color})},null,4),e("label",{for:"filt_dept_"+y,class:"select-none w-full cursor-pointer"},o(C.dept_shortname),9,me)],8,_e)]))),128))]))),128))],512),[[B,f.value.departments]])])):V("",!0),e("div",null,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[3]||(s[3]=t=>$("voeux"))},[e("p",null,"Voeux ("+o(v.value.length)+" séléctionné"+o(v.value.length>1?"s":"")+")",1),e("span",{class:L([f.value.voeux?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),d(e("div",ve,[e("button",{class:"hover:opacity-70 underline",onClick:Y},"Tout désélectionner"),e("div",he,[d(e("input",{id:"filt_voeux_1",type:"checkbox",class:"checkbox",value:"Aucun","onUpdate:modelValue":s[4]||(s[4]=t=>v.value=t)},null,512),[[b,v.value]]),fe]),e("div",xe,[d(e("input",{id:"filt_voeux_2",type:"checkbox",class:"checkbox",value:"AuMoinsUn","onUpdate:modelValue":s[5]||(s[5]=t=>v.value=t)},null,512),[[b,v.value]]),be])],512),[[B,f.value.voeux]])]),e("div",null,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[6]||(s[6]=t=>$("document"))},[e("p",null,"Documents ("+o(i.value.length)+" séléctionné"+o(i.value.length>1?"s":"")+")",1),e("span",{class:L([f.value.document?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),d(e("div",ye,[e("button",{class:"hover:opacity-70 underline",onClick:K},"Tout désélectionner"),e("div",ge,[d(e("input",{id:"filt_document_1",type:"checkbox",class:"checkbox",value:"0","onUpdate:modelValue":s[7]||(s[7]=t=>i.value=t)},null,512),[[b,i.value]]),we]),e("div",ke,[d(e("input",{id:"filt_document_2",type:"checkbox",class:"checkbox",value:"1","onUpdate:modelValue":s[8]||(s[8]=t=>i.value=t)},null,512),[[b,i.value]]),Ce]),e("div",De,[d(e("input",{id:"filt_document_2",type:"checkbox",class:"checkbox",value:"2","onUpdate:modelValue":s[9]||(s[9]=t=>i.value=t)},null,512),[[b,i.value]]),Ae]),e("div",Me,[d(e("input",{id:"filt_document_3",type:"checkbox",class:"checkbox",value:"3","onUpdate:modelValue":s[10]||(s[10]=t=>i.value=t)},null,512),[[b,i.value]]),Se])],512),[[B,f.value.document]])])]),u.value&&u.value.acc_id&&M.value&&M.value.accounts?(l(),a("div",Ue,[e("div",Ve,[e("p",Ee,[r("Liste des étudiants "),u.value.access.acs_accounttype==2?(l(),a("span",$e,[r("dans le département "),e("span",{style:D({color:u.value.department.dept_color})},o(u.value.department.dept_shortname),5)])):V("",!0),r(": "+o(w.value.length)+" résultat"+o(w.value.length>1?"s":""),1)]),e("div",je,[Le,S(oe,{texte:"Exporter tous les étudiants en csv",link:H.value},null,8,["link"])])]),e("div",Be,[e("label",Te,[d(e("input",{type:"text",class:"grow",placeholder:"Recherche par nom et prénom","onUpdate:modelValue":s[11]||(s[11]=t=>U.value=t)},null,512),[[te,U.value]]),ze])]),e("div",Ne,[w.value&&w.value.length>0?(l(!0),a(T,{key:0},z(w.value,(t,h)=>{var C,y;return l(),a("div",{key:h,class:""},[t.acc_id?(l(),a("div",{key:0,class:"bg-base-300 shadow-lg rounded-lg p-4 transform transition-transform duration-200 h-full flex flex-col",style:D({borderBottom:`4px solid ${t.department?t.department.dept_color:"#aaaaaa"}`})},[e("button",{class:"hover:opacity-70 p-3 hover:cursor-pointer absolute top-0 right-0 hover:scale-120 scale-100 transition-all duration-100 ease-in-out",onClick:O=>Q(t)},Ge,8,qe),e("div",Ie,[e("h5",Re,o(t.acc_fullname),1),e("h6",Oe,[r(o(t.acc_id)+" ",1),t.department?(l(),a("span",{key:0,style:D({color:t.department.dept_color})},"("+o(t.department.dept_shortname)+")",5)):(l(),a("span",Pe,"(Aucun département)"))])]),e("div",Qe,[e("p",Ze,[He,r(" "+o(t.wishes?t.wishes.count:0),1),Je,Ye,r(" "+o(((C=t.documents)==null?void 0:C.count)||0)+"/"+o((y=t.documents)==null?void 0:y.countmax),1),Ke,We,r(" "+o(R(t.acc_lastlogin)),1)])]),S(p,{to:{name:"Profile",params:{acc_id:t.acc_id}},class:"mt-3"},{default:j(()=>[Xe]),_:2},1032,["to"])],4)):V("",!0)])}),128)):(l(),a("div",et,st))]),e("dialog",ot,[e("div",nt,[lt,e("div",at,[ct,it,e("div",rt,[e("div",{class:"bg-base-300 shadow-lg rounded-lg p-4 h-full flex flex-col",style:D({borderBottom:`4px solid ${c.value.department?c.value.department.dept_color:"#aaaaaa"}`})},[e("div",ut,[e("h5",dt,o(c.value.acc_fullname),1),e("h6",pt,[r(o(c.value.acc_id)+" ",1),c.value.department?(l(),a("span",{key:0,style:D({color:c.value.department.dept_color})},"("+o(c.value.department.dept_shortname)+")",5)):(l(),a("span",_t,"(Aucun département)"))])]),e("div",mt,[e("p",vt,[ht,r(" "+o(c.value.wishes?c.value.wishes.count:0),1),ft,xt,r(" "+o(((x=c.value.documents)==null?void 0:x.count)||0)+"/"+o((k=c.value.documents)==null?void 0:k.countmax),1),bt,yt,r(" "+o(R(c.value.acc_lastlogin)),1)])])],4)])]),e("div",gt,[e("button",{class:"btn btn-error",onClick:I},"Annuler"),e("button",{class:"btn btn-success",onClick:s[12]||(s[12]=t=>{var h;return Z(c.value.acc_id,c.value.acc_fullname,((h=c.value.department)==null?void 0:h.dept_shortname)||"Aucun département")})},"Confirmer")])])],512)])):V("",!0)])):(l(),a("div",wt,[S(se)]))])}}};export{At as default};
