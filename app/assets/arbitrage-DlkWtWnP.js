import{r as h,c as ne,H as Q,o as ge,d as c,e as r,g as e,B as i,I as w,q as k,M,F as C,t as j,y as S,f as ye,h as U,i as L,n as I,x as O,C as G,L as be}from"./index-WfzvT7mn.js";const xe={key:0},we=e("p",{class:"font-bold text-xl text-center"},"Arbitrage",-1),ke={class:"flex"},Ce={class:"min-h-screen flex flex-col items-center"},je=e("p",{class:"text-center py-5"},"Liste des étudiants",-1),Ae={class:"flex items-center justify-center py-5"},Ee={key:0,class:"bg-base-200 drop-shadow-lg w-96"},De=e("p",{class:"bg-base-300 p-3 flex items-center justify-center font-bold text-lg select-none"},"Filtres",-1),Pe={class:"select-none"},Se={class:"select-none"},Te={class:"p-1"},Ue={class:"lg:block flex flex-wrap"},Le=["id","value"],Be=["for"],Me=["for"],Ve={class:"select-none"},$e={class:"p-1"},Ne=["id","value"],Fe=["for"],Ie=["for"],Oe={class:"select-none"},Ge={class:"p-1"},Ze=["id","value"],qe=["for"],ze={class:"relative inline-block mr-1"},He={key:0,class:"absolute inset-0 flex items-center justify-center text-black text-lg font-bold bg-white select-none"},Je=["for"],Ke={class:"flex flex-col items-center justify-start w-full"},Qe=["id"],Re={class:"flex items-center justify-between w-full p-1"},We={key:1,class:"bg-gray-500 p-2 rounded-lg min-w-16 text-center"},Xe={class:"flex flex-col w-full items-center justify-start"},Ye={class:"w-full text-center"},et={key:0,class:"py-1"},tt=["onClick"],st=e("p",null,"Voir les voeux",-1),nt={class:"p-1 w-full"},lt={class:"min-w-fit"},ot={class:"flex w-full items-center justify-start ml-2"},at={class:"relative inline-block mr-1"},ct={key:0,class:"absolute inset-0 flex items-center justify-center text-black text-lg font-bold bg-white select-none"},rt={class:"min-h-screen flex flex-col items-center w-full"},it=e("p",{class:"text-center py-5 w-full"},"Liste des accords",-1),ut={class:"flex items-center justify-center py-5 w-full"},dt={key:0,class:"bg-base-200 drop-shadow-lg w-11/12"},vt=e("p",{class:"bg-base-300 p-3 flex items-center justify-center font-bold text-lg select-none"},"Filtres",-1),ft={class:"select-none"},pt={class:"select-none"},_t={class:"p-1"},mt={class:"flex flex-wrap items-center justify-start"},ht=["id","value"],gt={class:"flex w-full"},yt=["for"],bt=["for"],xt={class:"flex flex-col items-center justify-start w-full select-none"},wt={class:"flex items-center justify-center mb-2"},kt={class:"relative inline-block mr-2"},Ct={key:0,class:"absolute inset-0 flex items-center justify-center text-black text-lg font-bold bg-white select-none"},jt={class:"font-bold text-lg"},At={class:"text-center mb-3"},Et={class:"w-full flex justify-center"},Dt={class:"flex flex-wrap gap-4 justify-center w-full"},Pt=["id"],St=["id"],Tt=["onClick"],Ut=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Lt=[Ut],Bt={key:1,class:""},Mt=["onClick"],Vt=e("p",{class:"text-lg font-bold"},"+",-1),$t=[Vt],Nt={key:1},Gt={__name:"arbitrage",setup(Ft){const le=h([]),g=h([]),B=h([]),R=h([]),W=h([]),Z=h(!1),y=h([]),b=h([]),A=h([]),x=h([]),V=h([]),P=h([]),u=h([]),oe=[{val:0,name:"Aucun voeux"},{val:1,name:"1 voeu"},{val:2,name:"2 voeux"},{val:3,name:"3 voeux"},{val:4,name:"4 voeux"},{val:5,name:"5 voeux"},{val:6,name:"6 voeux"}],_=h({pays:!1,departments:!1,accords:!1,voeux:!1,etudiants:[]});function $(n){_.value[n]=!_.value[n]}const ae=n=>{_.value.etudiants[n]=!_.value.etudiants[n]};async function ce(){Z.value=!1,await U("GET",!1,g,L.apiUrl+"api/agreement"),await U("GET",!1,R,L.apiUrl+"api/component"),await U("GET",!1,W,L.apiUrl+"api/partnercountry"),await U("GET",!1,B,L.apiUrl+"api/account/students"),await U("GET",!1,V,L.apiUrl+"api/arbitrage"),Z.value=!0,re(),B.value&&B.value.accounts&&(_.value.etudiants=B.value.accounts.reduce((n,s)=>(n[s.acc_id]=!1,n),{}))}async function re(){P.value=B.value.accounts.filter(n=>!V.value.some(s=>s.account.acc_id===n.acc_id)).reduce((n,s)=>(n[s.acc_id]=s,n),{}),u.value=g.value.agreements.reduce((n,s)=>{const t=q(s.agree_id),l=V.value.filter(o=>o.agreement.agree_id===s.agree_id);return n[s.agree_id]={agreement:s,accounts:t.map(o=>{const a=l.find(v=>v.arb_pos===o+1);return{arb_pos:o+1,account:a?a.account:null}})},n},{}),await I(),T(),H()}async function N(){const n=Object.values(u.value).reduce((s,t)=>(t.accounts.forEach(l=>{l.account&&s.push({acc_id:l.account.acc_id,agree_id:t.agreement.agree_id,arb_pos:l.arb_pos})}),s),[]);await U("POST",!0,le,L.apiUrl+"api/arbitrage",n)}const X=ne(()=>Object.values(P.value).filter(n=>{var s;return y.value.length===0?!0:y.value.includes((s=n.department)==null?void 0:s.dept_shortname)}).filter(n=>{const s=F(n).map(t=>t.agreement.agree_id);return b.value.length===0||b.value.some(t=>s.includes(t))}).filter(n=>{const s=n.wishes.count;return A.value.length===0||A.value.includes(s)}).sort((n,s)=>{const t=Math.min(...F(n).filter(o=>b.value.includes(o.agreement.agree_id)).map(o=>o.place)),l=Math.min(...F(s).filter(o=>b.value.includes(o.agreement.agree_id)).map(o=>o.place));return t!==l?t-l:n.acc_fullname.localeCompare(s.acc_fullname)})),Y=ne(()=>Object.values(u.value).filter(n=>x.value.length===0||x.value.includes(n.agreement.partnercountry.parco_name)));function F(n){const s=n.wishes;return[{place:1,id:s.wsha_one},{place:2,id:s.wsha_two},{place:3,id:s.wsha_three},{place:4,id:s.wsha_four},{place:5,id:s.wsha_five},{place:6,id:s.wsha_six}].filter(l=>l!==null).map(l=>{const o=g.value.agreements.find(a=>a.agree_id===l.id);return{place:l.place,agreement:o}}).filter(l=>l.agreement!==void 0)}function ie(n,s){const t=u.value[n].accounts[s].account;P.value[t.acc_id]=t,u.value[n].accounts[s].account=null,T(),N()}async function ue(n){let s=g.value.agreements.find(l=>l.agree_id===n),t=q(n).length;s&&(s.agree_nbplace!==t&&(s.agree_nbplace=t),s.agree_nbplace+=1,u.value[n]||(u.value[n]={accounts:[]}),u.value[n].accounts||(u.value[n].accounts=[]),u.value[n].accounts.push({arb_pos:u.value[n].accounts.length+1,account:null}),await I(),H())}function q(n){const t=g.value.agreements.find(d=>d.agree_id===n);if(!t)return console.error(`Accord avec agreeId ${n} non trouvé.`),[];const l=t.agree_nbplace,a=V.value.filter(d=>d.agree_id===n).reduce((d,f)=>f.arb_pos>d?f.arb_pos:d,l-1),v=Math.max(l,a);return Array.from({length:v},(d,f)=>f)}async function z(){await I(),T(),H()}Q(y,z),Q(b,z),Q(A,z);async function H(){let n=document.getElementsByClassName("dropZones");for(let s of n)s.addEventListener("dragover",function(t){t.preventDefault()}),s.addEventListener("drop",function(t){t.preventDefault();let l=t.dataTransfer.getData("text/plain"),o=document.getElementById(l);if(o){const a=o.id.replace("etu_drag_",""),v=s.id.match(/^drop_(\d+)_(\d+)$/);if(v){const p=parseInt(v[1]),d=parseInt(v[2]);let f=P.value[a];if(f){const m=u.value[p].accounts[d];if(m&&m.account!=null){const E=m.account.acc_id;E!==f.acc_id&&(P.value[E]=m.account)}P.value[a]&&delete P.value[a],u.value[p].accounts[d].account=f,T(),N()}else if(f)console.error("Étudiant non trouvé dans localEtus.value ou localArbitrage.value avec etuId :",a);else if(f=de(a),J(a)-1!=d||K(a)!=p){const m=u.value[p].accounts[d];m&&m.account!=null?(u.value[K(a)].accounts[J(a)-1].account=m.account,u.value[p].accounts[d].account=f,T(),N()):(u.value[K(a)].accounts[J(a)-1].account=null,u.value[p].accounts[d].account=f,T(),N())}}else console.error("ID de dropZone non valide :",s.id)}})}function de(n){for(let s in u.value){const t=u.value[s].accounts;for(let l of t)if(l.account&&l.account.acc_id==n)return l.account}return null}function J(n){for(let s in u.value){const t=u.value[s].accounts;for(let l=0;l<t.length;l++){const o=t[l];if(o.account&&o.account.acc_id===n)return l+1}}return null}function K(n){for(let s in u.value){const t=u.value[s].accounts;for(let l of t)if(l.account&&l.account.acc_id===n)return parseInt(s)}return console.error("Aucun accord trouvé pour l'acc_id :",n),null}async function T(){await I();let n=document.getElementsByClassName("elementDrag");for(let s of n)s.hasListener||(s.addEventListener("dragstart",ve),s.hasListener=!0)}function ve(n){n.dataTransfer.setData("text/plain",n.target.id)}function fe(){y.value=[]}function pe(){b.value=[]}function _e(){x.value=[]}function me(){A.value=[]}return ge(ce),(n,s)=>Z.value?(c(),r("div",xe,[we,e("div",ke,[e("div",Ce,[je,e("div",Ae,[g.value&&g.value.agreements?(c(),r("div",Ee,[De,e("p",Pe,i(X.value.length)+" résultats ("+i(y.value.length)+" filtre"+i(y.value.length>1?"s":"")+")",1),e("div",null,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[0]||(s[0]=t=>$("departments"))},[e("p",Se,"Départements ("+i(y.value.length)+" séléctionné"+i(y.value.length>1?"s":"")+")",1),e("span",{class:w([_.value.departments?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),k(e("div",Te,[e("button",{class:"hover:opacity-70 underline",onClick:fe},"Tout désélectionner"),(c(!0),r(C,null,j(R.value.components,(t,l)=>(c(),r("div",{key:l},[e("div",Ue,[e("p",null,"- "+i(t.comp_name),1),(c(!0),r(C,null,j(t.departments,(o,a)=>(c(),r("div",{key:a,class:"flex items-center hover:opacity-60 my-1 hover:cursor-pointer"},[k(e("input",{id:"filt_dept_"+a,type:"checkbox",class:"checkbox",value:o.dept_shortname,"onUpdate:modelValue":s[1]||(s[1]=v=>y.value=v)},null,8,Le),[[O,y.value]]),e("label",{for:"filt_dept_"+a,class:"w-full flex items-center justify-center cursor-pointer pl-2"},[e("div",{class:"lg:w-3 w-6 lg:h-3 h-3 mr-2",style:G({backgroundColor:o.dept_color})},null,4),e("label",{for:"filt_dept_"+a,class:"select-none w-full hover:cursor-pointer"},i(o.dept_shortname),9,Me)],8,Be)]))),128))])]))),128))],512),[[M,_.value.departments]])]),e("div",null,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[2]||(s[2]=t=>$("voeux"))},[e("p",Ve,"Nombre de voeux ("+i(A.value.length)+" séléctionné"+i(A.value.length>1?"s":"")+")",1),e("span",{class:w([_.value.voeux?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),k(e("div",$e,[e("button",{class:"hover:opacity-70 underline",onClick:me},"Tout désélectionner"),(c(),r(C,null,j(oe,(t,l)=>e("div",{key:l,class:"flex items-center hover:opacity-60 my-1 hover:cursor-pointer"},[k(e("input",{id:"filt_voeux_"+l,type:"checkbox",class:"checkbox",value:t.val,"onUpdate:modelValue":s[3]||(s[3]=o=>A.value=o)},null,8,Ne),[[O,A.value]]),e("label",{for:"filt_voeux_"+l,class:"cursor-pointer w-full pl-2"},[e("label",{for:"filt_voeux_"+l,class:"select-none w-full hover:cursor-pointer"},i(t.name),9,Ie)],8,Fe)])),64))],512),[[M,_.value.voeux]])]),e("div",null,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[4]||(s[4]=t=>$("accords"))},[e("p",Oe,"Accords (voeux) ("+i(b.value.length)+" séléctionné"+i(b.value.length>1?"s":"")+")",1),e("span",{class:w([_.value.accords?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),k(e("div",Ge,[e("button",{class:"hover:opacity-70 underline",onClick:pe},"Tout désélectionner"),(c(!0),r(C,null,j(g.value.agreements,(t,l)=>{var o,a,v,p;return c(),r("div",{key:l,class:"flex items-center hover:opacity-60 my-1 hover:cursor-pointer"},[k(e("input",{id:"filt_accord_"+l,type:"checkbox",class:"checkbox",value:t.agree_id,"onUpdate:modelValue":s[5]||(s[5]=d=>b.value=d)},null,8,Ze),[[O,b.value]]),e("label",{for:"filt_accord_"+l,class:"cursor-pointer w-full pl-2"},[e("span",ze,[e("span",{class:w(["fi","fi-"+((o=t.partnercountry)==null?void 0:o.parco_code)])},null,2),(a=t.partnercountry)!=null&&a.parco_code?S("",!0):(c(),r("span",He," ? "))]),e("label",{for:"filt_accord_"+l,class:"select-none w-full hover:cursor-pointer"},i(((v=t.university)==null?void 0:v.univ_name)||"Université indisponible")+" - "+i(((p=t.isced)==null?void 0:p.isc_code)||"Code ISCED ?"),9,Je)],8,qe)])}),128))],512),[[M,_.value.accords]])])])):S("",!0)]),e("div",Ke,[(c(!0),r(C,null,j(X.value,(t,l)=>(c(),r("div",{class:"elementDrag bg-base-300 w-96 mb-2 flex items-center justify-center cursor-move select-none hover:opacity-80 flex-col",draggable:!0,id:"etu_drag_"+t.acc_id,key:l,style:G({borderBottom:`4px solid ${t.department?t.department.dept_color:"#aaaaaa"}`})},[e("div",Re,[t.department?(c(),r("p",{key:0,style:G({backgroundColor:t.department.dept_color}),class:"p-2 rounded-lg min-w-16 text-center"},i(t.department.dept_shortname),5)):(c(),r("p",We,"Aucun")),e("div",Xe,[e("p",Ye,i(t.acc_fullname),1),t.wishes.count<=0?(c(),r("p",et,"Aucun voeux enregistrés.")):S("",!0)])]),t.wishes.count>0?(c(),r("div",{key:0,class:"bg-base-200 w-full p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:o=>ae(t.acc_id)},[st,e("span",{class:w([_.value.etudiants[t.acc_id]?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)],8,tt)):S("",!0),k(e("div",nt,[e("div",null,[e("div",null,[(c(!0),r(C,null,j(F(t),(o,a)=>{var v,p,d,f,m,E;return c(),r("div",{key:a,class:"flex justify-between"},[e("p",lt,"Voeu "+i(o.place),1),e("div",ot,[e("span",at,[e("span",{class:w(["fi","fi-"+((p=(v=o.agreement)==null?void 0:v.partnercountry)==null?void 0:p.parco_code)])},null,2),(f=(d=o.agreement)==null?void 0:d.partnercountry)!=null&&f.parco_code?S("",!0):(c(),r("span",ct," ? "))]),e("p",null,i(((m=o.agreement.university)==null?void 0:m.univ_name)||"Université indisponible")+" "+i(((E=o.agreement.isced)==null?void 0:E.isc_code)||"Code ISCED ?"),1)])])}),128))])])],512),[[M,_.value.etudiants[t.acc_id]]])],12,Qe))),128))])]),e("div",rt,[it,e("div",ut,[g.value&&g.value.agreements?(c(),r("div",dt,[vt,e("p",ft,i(Y.value.length)+" résultats ("+i(x.value.length)+" filtre"+i(x.value.length>1?"s":"")+")",1),e("div",null,[e("div",{class:"bg-base-300 p-2 mt-1 flex justify-between items-center hover:opacity-60 hover:cursor-pointer",onClick:s[6]||(s[6]=t=>$("pays"))},[e("p",pt,"Pays ("+i(x.value.length)+" séléctionné"+i(x.value.length>1?"s":"")+")",1),e("span",{class:w([_.value.pays?"rotate-180":"","transform transition-transform text-xl select-none"])},"▾",2)]),k(e("div",_t,[e("button",{class:"hover:opacity-70 underline",onClick:_e},"Tout désélectionner"),e("div",mt,[(c(!0),r(C,null,j(W.value,(t,l)=>(c(),r("div",{key:l,class:"flex items-center hover:opacity-60 my-1 md:w-2/6 xl:w-1/6 hover:cursor-pointer"},[k(e("input",{id:"filt_pays_"+l,type:"checkbox",class:"checkbox mx-2 checkbox-sm",value:t.parco_name,"onUpdate:modelValue":s[7]||(s[7]=o=>x.value=o)},null,8,ht),[[O,x.value]]),e("div",gt,[e("label",{for:"filt_pays_"+l,class:"w-full cursor-pointer"},[e("span",{class:w(["fi mr-1","fi-"+t.parco_code])},null,2),e("label",{for:"filt_pays_"+l,class:"select-none w-full text-sm hover:cursor-pointer"},i(t.parco_name),9,bt)],8,yt)])]))),128))])],512),[[M,_.value.pays]])])])):S("",!0)]),e("div",xt,[(c(!0),r(C,null,j(Y.value,(t,l)=>{var o,a,v,p,d,f,m,E;return c(),r("div",{key:"accord-"+l,class:"bg-base-300 w-11/12 mb-4 p-4 rounded-lg"},[e("div",wt,[e("span",kt,[e("span",{class:w(["fi md:text-3xl text-xl transition-all duration-200 ease-in-out","fi-"+((a=(o=t.agreement)==null?void 0:o.partnercountry)==null?void 0:a.parco_code)])},null,2),(p=(v=t.agreement)==null?void 0:v.partnercountry)!=null&&p.parco_code?S("",!0):(c(),r("span",Ct," ? "))]),e("p",jt,i(((d=t.agreement.partnercountry)==null?void 0:d.parco_name)||"Pays indisponible"),1)]),e("p",At,i(((f=t.agreement.university)==null?void 0:f.univ_name)||"Université indisponible")+" - "+i(((m=t.agreement.isced)==null?void 0:m.isc_code)||"Code ISCED indisponible")+" "+i(((E=t.agreement.isced)==null?void 0:E.isc_name)||"Nom ISCED indisponible"),1),e("div",Et,[e("div",Dt,[(c(!0),r(C,null,j(q(t.agreement.agree_id),(he,D)=>{var ee,te,se;return c(),r("div",{id:"drop_"+t.agreement.agree_id+"_"+D,key:"place-"+D,class:"dropZones bg-base-200 m-1 h-20 w-72 relative flex items-center justify-center"},[t.accounts[D]&&t.accounts[D].account?(c(),r("div",{key:0,draggable:"true",id:"etu_drag_"+t.accounts[D].account.acc_id,class:"h-full w-full flex items-center justify-center elementDrag cursor-move hover:opacity-60",style:G({borderBottom:`4px solid ${((se=(te=(ee=t.accounts[D])==null?void 0:ee.account)==null?void 0:te.department)==null?void 0:se.dept_color)||"#aaaaaa"}`})},[e("p",null,i(t.accounts[D].account.acc_fullname),1),e("button",{onClick:It=>ie(t.agreement.agree_id,D),class:"hover:cursor-pointer hover:opacity-60 absolute top-0 right-0 p-2"},Lt,8,Tt)],12,St)):(c(),r("p",Bt,"Aucun étudiant"))],8,Pt)}),128)),e("div",{class:"w-72 h-20 m-1 flex items-center justify-center border-8 border-base-200 bg-base-100 hover:opacity-60 cursor-pointer",onClick:he=>ue(t.agreement.agree_id)},$t,8,Mt)])])])}),128))])])])])):(c(),r("div",Nt,[ye(be)]))}};export{Gt as default};
